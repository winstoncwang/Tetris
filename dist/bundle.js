!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){r(1),r(5)},function(e,t,r){var n=r(2),i=r(3);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var o={insert:"head",singleton:!1};n(i,o);e.exports=i.locals||{}},function(e,t,r){"use strict";var n,i=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},o=function(){var e={};return function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}e[t]=r}return e[t]}}(),c=[];function a(e){for(var t=-1,r=0;r<c.length;r++)if(c[r].identifier===e){t=r;break}return t}function s(e,t){for(var r={},n=[],i=0;i<e.length;i++){var o=e[i],s=t.base?o[0]+t.base:o[0],u=r[s]||0,l="".concat(s," ").concat(u);r[s]=u+1;var f=a(l),h={css:o[1],media:o[2],sourceMap:o[3]};-1!==f?(c[f].references++,c[f].updater(h)):c.push({identifier:l,updater:v(h,t),references:1}),n.push(l)}return n}function u(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var i=r.nc;i&&(n.nonce=i)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var c=o(e.insert||"head");if(!c)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");c.appendChild(t)}return t}var l,f=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function h(e,t,r,n){var i=r?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=f(t,i);else{var o=document.createTextNode(i),c=e.childNodes;c[t]&&e.removeChild(c[t]),c.length?e.insertBefore(o,c[t]):e.appendChild(o)}}function d(e,t,r){var n=r.css,i=r.media,o=r.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),o&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var p=null,y=0;function v(e,t){var r,n,i;if(t.singleton){var o=y++;r=p||(p=u(t)),n=h.bind(null,r,o,!1),i=h.bind(null,r,o,!0)}else r=u(t),n=d.bind(null,r,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=i());var r=s(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<r.length;n++){var i=a(r[n]);c[i].references--}for(var o=s(e,t),u=0;u<r.length;u++){var l=a(r[u]);0===c[l].references&&(c[l].updater(),c.splice(l,1))}r=o}}}},function(e,t,r){(t=r(4)(!1)).push([e.i,"* {\n\tmargin: 0 !important;\n\tpadding: 0 !important;\n}\n\nbody {\n\theight: 100vh;\n\twidth: 100vw;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n",""]),e.exports=t},function(e,t,r){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r=e[1]||"",n=e[3];if(!n)return r;if(t&&"function"==typeof btoa){var i=(c=n,a=btoa(unescape(encodeURIComponent(JSON.stringify(c)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(s," */")),o=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[r].concat(o).concat([i]).join("\n")}var c,a,s;return[r].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r})).join("")},t.i=function(e,r,n){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(n)for(var o=0;o<this.length;o++){var c=this[o][0];null!=c&&(i[c]=!0)}for(var a=0;a<e.length;a++){var s=[].concat(e[a]);n&&i[s[0]]||(r&&(s[2]?s[2]="".concat(r," and ").concat(s[2]):s[2]=r),t.push(s))}},t}},function(e,t,r){"use strict";r.r(t);var n={UP:38,DOWN:40,LEFT:37,RIGHT:39,SPACE:32};function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var i=l(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return u(this,r)}}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(u,e);var t,r,i,o=s(u);function u(e,t,r,n,i,c){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(a=o.call(this)).gameLoop=function(e){a.now=e,a.dt=Math.min(1,(a.now-a.last)/1e3),a.update(a.dt),a.gameRunning&&(a.draw(),a.last=a.now,a.frameId=window.requestAnimationFrame(a.gameLoop))},a.keyQueue=function(e){switch(e.keyCode){case a.KEY.UP:a.evQueue.push(a.KEY.UP);break;case a.KEY.DOWN:a.evQueue.push(a.KEY.DOWN);break;case a.KEY.LEFT:a.evQueue.push(a.KEY.LEFT);break;case a.KEY.RIGHT:a.evQueue.push(a.KEY.RIGHT);break;case a.KEY.SPACE:a.run()}},a.handler=function(e){switch(e){case a.KEY.UP:a.move(a.KEY.UP);break;case a.KEY.DOWN:a.move(a.KEY.DOWN);break;case a.KEY.LEFT:a.move(a.KEY.LEFT);break;case a.KEY.RIGHT:a.move(a.KEY.RIGHT)}},a.draw=function(){a.drawWell(),function(e,t,r,n){var i=e.width/4,o=e.height/4,c="i"===r.blockType?0:"o"===r.blockType?1:.5,a="i"===r.blockType?.5:1;t.clearRect(0,0,e.width,e.height),t.fillStyle="lightgrey",t.fillRect(0,0,e.width,e.height),n(c,a,r,(function(e,r,n){t.fillStyle=n,t.fillRect(e*i,r*o,i,o),t.strokeRect(e*i,r*o,i,o)}))}(a.canvasNext,a.ctxNext,a.next,a.eachPixel),a.drawPiece()},a.drawPiece=function(){a.eachPixel(a.current.x,a.current.y,a.current,a.drawPixel)},a.eachPixel=function(e,t,r,n){for(var i=r.blockType,o=r.dir,c=0,s=0,u=a.tetrominoes[i],l=u.color,f=u.blocks,h=32768;h>0;h>>=1)f[o]&h&&n(e+s,t+c,l),4==++s&&(s=0,c++)},a.drawPixel=function(e,t,r){a.ctx.fillStyle=r,a.ctx.fillRect(e*a.px,t*a.py,a.px,a.py),a.ctx.strokeRect(e*a.px,t*a.py,a.px,a.py)},a.canvas=e,a.canvasNext=r,a.body=t,a.tetrominoes=n,a.DIR=i,a.KEY=c,a.ctx=a.canvas.getContext("2d"),a.ctxNext=a.canvasNext.getContext("2d"),a.cw=a.canvas.width,a.ch=a.canvas.height,a.last=0,a.now=0,a.dt=0,a.step=1,a.t=0,a.wx=10,a.wy=20,a.body.addEventListener("keydown",a.keyQueue),a.evQueue=[],a.validSpace,a.current,a.next,a.pieceArr=Array(a.wx).fill().map((function(){return Array(a.wy).fill(null)})),a.gameRunning=!1,a}return t=u,(r=[{key:"setCurrentPiece",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.randomBlock();this.current=e}},{key:"setNextPiece",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.randomBlock();this.next=e}},{key:"setPieceArr",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.current.blockType;this.pieceArr[e][t]=r}},{key:"getPieceArr",value:function(e,t){return this.pieceArr[e][t]}},{key:"run",value:function(){this.gameRunning||(this.frameId=window.requestAnimationFrame(this.gameLoop),this.gameRunning=!0,this.px=this.canvas.width/this.wx,this.py=this.canvas.height/this.wy,this.setCurrentPiece(),this.setNextPiece())}},{key:"move",value:function(e){var t=this.current.x,r=this.current.y;switch(e){case n.UP:this.rotate(this.current);break;case n.DOWN:this.current.y+=1;break;case n.LEFT:this.current.x-=1;break;case n.RIGHT:this.current.x+=1}return!!this.validSpace()||(this.current.x=t,this.current.y=r,!1)}},{key:"rotate",value:function(e){switch(e.dir){case this.DIR.UP:this.current.dir=this.DIR.RIGHT;break;case this.DIR.RIGHT:this.current.dir=this.DIR.DOWN;break;case this.DIR.DOWN:this.current.dir=this.DIR.LEFT;break;case this.DIR.LEFT:this.current.dir=this.DIR.UP}}},{key:"validSpace",value:function(){var e=this,t=!0;return this.eachPixel(this.current.x,this.current.y,this.current,(function(r,n){(r<0||r>=e.wx||n<0||n>=e.wy||e.getPieceArr(r,n))&&(t=!1)})),t}},{key:"update",value:function(e){this.handler(this.evQueue.shift()),this.t+=e,this.t>this.step&&(this.t-=this.step,this.drop())}},{key:"drawWell",value:function(){this.ctx.clearRect(0,0,this.cw,this.ch),this.ctx.fillStyle="lightgrey",this.ctx.fillRect(0,0,this.cw,this.ch);for(var e=0;e<this.wy;e++)for(var t=0;t<this.wx;t++)this.getPieceArr(t,e)&&this.drawPixel(t,e,this.tetrominoes[this.getPieceArr(t,e)].color);this.ctx.strokeRect(0,0,this.px*this.wx,this.py*this.wy)}},{key:"drop",value:function(){this.move(this.KEY.DOWN)||(this.current.y<1&&this.reset(),this.gameRunning&&(this.droppedPiece(),this.eachRow(),this.setCurrentPiece(this.next),this.setNextPiece(),this.clearEvQueue()))}},{key:"droppedPiece",value:function(){var e=this;this.eachPixel(this.current.x,this.current.y,this.current,(function(t,r){e.setPieceArr(t,r)}))}},{key:"reset",value:function(){alert("game over"),window.cancelAnimationFrame(this.frameId),this.gameRunning=!1,this.pieceArr.forEach((function(e){return e.forEach((function(t,r){t&&(e[r]=null)}))}))}}])&&c(t.prototype,r),i&&c(t,i),u}(function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eachRow=function(){var e,r=!0;for(e=t.wy;e>=0;e--){for(var n=0;n<t.wx;n++){if(!t.getPieceArr(n,e)){r=!1;break}r=!0}r&&(t.removeLine(e),e++)}},this.removeLine=function(e){for(var r=e;r>=0;r--)for(var n=0;n<t.wx;n++)t.setPieceArr(n,r,0==r?null:t.getPieceArr(n,r-1))},this.randomBlock=function(){for(;;){for(var e=0;e<6&&(t.i=Math.floor(35*Math.random()),t.piece=t.bag[t.i],!1!==t.history.includes(t.piece)&&5!==e);++e)t.order.length&&(t.bag[t.i]=t.order[0]);return t.order.includes(t.piece)&&t.order.splice(t.order.indexOf(t.piece),1),t.order.push(t.piece),t.bag[t.i]=t.order[0],t.history.shift(),t.history[3]=t.piece,{blockType:t.piece,x:Math.floor(Math.random()*(t.wx-t.tetrominoes[t.piece].size)),y:-1,dir:t.DIR.UP}}},this.tetro=["i","j","l","o","s","t","z"],this.order=[],this.bag=this.tetro.concat(this.tetro,this.tetro,this.tetro,this.tetro),this.firstPiece=["i","j","l","t"][Math.floor(4*Math.random())],this.history=["s","z","o",this.firstPiece]}var t,r,n;return t=e,(r=[{key:"clearEvQueue",value:function(){this.evQueue=[]}}])&&i(t.prototype,r),n&&i(t,n),e}()),h=document.querySelector("#next");new f(document.querySelector("#canvas"),document.querySelector("body"),h,{i:{blocks:["0x0F00","0x2222","0x00F0","0x4444"],size:4,color:"cyan"},j:{blocks:["0x8E00","0x6440","0x0E20","0x44C0"],size:3,color:"blue"},l:{blocks:["0x2E00","0x4460","0x0E80","0xC440"],size:3,color:"orange"},o:{blocks:["0xCC00","0xCC00","0xCC00","0xCC00"],size:2,color:"yellow"},s:{blocks:["0x6C00","0x4620","0x06C0","0x8C40"],size:3,color:"green"},t:{blocks:["0x4E00","0x4640","0x0E40","0x4C40"],size:3,color:"purple"},z:{blocks:["0xC600","0x2640","0x0C60","0x4C80"],size:3,color:"red"}},{UP:0,RIGHT:1,DOWN:2,LEFT:3},n)}]);